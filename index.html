<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rhama Chat - AI Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [Styles tetap sama seperti sebelumnya] */
    </style>
</head>
<body>
    <!-- [Struktur HTML tetap sama] -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ... [kode sebelumnya] ...

            // Fungsi untuk memanggil API Gemini 2.0 Flash
            async function fetchGeminiResponse(message, imageData, mode) {
                const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;
                
                // PERBAIKAN: Tambahkan instruksi untuk menghindari Markdown
                const systemPrompt = mode === 'deepThink' ? 
                    "Anda adalah asisten AI yang berpikir kritis dan mendalam. Berikan jawaban analitis yang komprehensif, detail, dan terstruktur dengan baik. HINDARI penggunaan format markdown seperti *, **, atau ``` dalam jawaban Anda. Gunakan teks biasa saja." : 
                    "Anda adalah asisten AI pencari informasi. Berikan jawaban yang ringkas, relevan, dan berdasarkan informasi terkini. HINDARI penggunaan format markdown seperti *, **, atau ``` dalam jawaban Anda. Gunakan teks biasa saja.";
                
                // ... [kode memori percakapan tetap sama] ...
                
                try {
                    // ... [kode request tetap sama] ...
                    
                    // Ekstrak teks dari respons
                    if (data.candidates && 
                        data.candidates[0] && 
                        data.candidates[0].content && 
                        data.candidates[0].content.parts &&
                        data.candidates[0].content.parts[0] &&
                        data.candidates[0].content.parts[0].text) {
                        
                        // PERBAIKAN: Hapus simbol asterisk jika masih ada
                        let responseText = data.candidates[0].content.parts[0].text;
                        responseText = responseText.replace(/\*\*/g, '') // Hapus **
                                 .replace(/\*/g, '')   // Hapus *
                                 .replace(/```/g, ''); // Hapus ```
                        
                        return responseText;
                    } else {
                        throw new Error('Format respons tidak valid');
                    }
                } catch (error) {
                    console.error('API Error:', error);
                    throw new Error(`Gagal mendapatkan respons: ${error.message}`);
                }
            }

            // ... [kode selanjutnya tetap sama] ...
        });
    </script>
</body>
</html>
